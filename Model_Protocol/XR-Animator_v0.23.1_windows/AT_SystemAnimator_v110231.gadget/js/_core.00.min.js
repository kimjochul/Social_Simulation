// 2023-01-30
var xul_mode,webkit_mode;var DragDrop={init:function(e,t,r){if(xul_mode){e.addEventListener("dragover",XPCOM_object._dragOver,true);e.addEventListener("drop",XPCOM_object._dragDrop,true)}else if(webkit_mode){e.addEventListener("dragenter",WebKit_object._dragEnter,false);e.addEventListener("dragexit",WebKit_object._dragExit,false);e.addEventListener("dragover",WebKit_object._dragOver,false);e.addEventListener("drop",WebKit_object._drop,false)}else{e.ondragenter=function(e){DragDrop.onDragEnter(e)};e.ondragover=function(e){DragDrop.onDragOver(e)};e.ondrop=function(e){DragDrop.onDrop(e)}}this.onDrop_finish=t;this.validate_func=r?r:function(e){return e.isFolder};if(!ie9_mode)return;this._ondrop_finish=t;this._ondrop_finish_process=async function(e,t){await DragDrop.drop_target(e.isFolder)._ondrop_finish(e,t)};Object.defineProperty(this,"onDrop_finish",{get:function(){return this._ondrop_finish_process},set:function(e){this._ondrop_finish=e}});this._validate_func=this.validate_func;this._validate_func_process=function(e,t){return DragDrop.drop_target(e.isFolder)._validate_func(e,t)};Object.defineProperty(this,"validate_func",{get:function(){return this._validate_func_process},set:function(e){this._validate_func=e}});this.drop_target=function(e){var t;if(!e&&!this._no_relay){var r=self.is_SA_child_animation?parent:self;var n=r.DragDrop.relay_id;if(n!=null&&r.SA_child_animation[n])t=r.document.getElementById("Ichild_animation"+n).contentWindow.DragDrop}if(!t){t=self.is_SA_child_animation&&self.ChildMirror_id!=null&&parent.SA_child_animation[ChildMirror_id]?parent.document.getElementById("Ichild_animation"+ChildMirror_id).contentWindow.DragDrop:this}return t}},validateDropItem:function(e){try{var t=System.Shell.itemFromFileDrop(e,0);return this.validate_func(t)}catch(r){return false}},_dragAccepted:false,onDragEnter:function(e){event.returnValue=false;if(this.validateDropItem(event.dataTransfer)){event.dataTransfer.dropEffect="link";this._dragAccepted=true}else{event.dataTransfer.dropEffect="none";this._dragAccepted=false}},onDragOver:function(e){if(this._dragAccepted){event.returnValue=false;event.dataTransfer.dropEffect="link"}},onDrop:function(e){event.returnValue=false;var t=System.Shell.itemFromFileDrop(event.dataTransfer,0);if(t==null)return;this.onDrop_finish(t)}};
var use_gallery_img_cache;var use_native_img;var native_img_objs=[];function imgCache_Object(i,e,t){self[i]=null;this.img_id=i;this.img_parent_id=e;this.use_native_img=!!t;if(t)native_img_objs.push(this);this.path_last="";this.img_cache=[];this.SS_mode=false;this.img_for_preload=null;this.SS_preload=imgCache_SS_Preload;this.SS_path_list_lvl=0;this.SS_path_list_index=-1;this.SS_path_list=[null,null];this.SS_path=null;this.load=imgCache_Load;this.show=imgCache_Show;this.clear=imgCache_Clear;this.createIMG=imgCache_CreateIMG;this.styleUpdate=imgCache_StyleUpdate}function imgCache_Clear(){self[this.img_id]=null;this.img_cache=[]}function imgCache_StyleObject(){this.posLeft=null;this.posTop=null;this.pixelWidth=null;this.pixelHeight=null}function imgCache_StyleUpdate(){if(!this.use_native_img)return;var i=self[this.img_id];var e=i.img;var t=i.width;var s=i.height;var h=e.width;var l=e.height;var a=i.style;if(a.pixelWidth!=null)e.width=h=a.pixelWidth;if(a.pixelHeight!=null)e.height=l=a.pixelHeight;if(a.posLeft!=null)e.left=a.posLeft+(h-t)/2;if(a.posTop!=null)e.top=a.posTop+(l-s)/2}function imgCache_CreateIMG(i){var e;if(this.use_native_img){var t=toLocalPath(i);e={img:BG.addImageObject(t,0,0),src:i,style:new imgCache_StyleObject};e.width=e.img.width;e.height=e.img.height}else{e=document.createElement("img");e.style.position="absolute";e.src=i;document.getElementById(this.img_parent_id).appendChild(e)}e.docked=System.Gadget.docked;return e}function imgCache_Show(i){var e=self[this.img_id];if(!e)return;if(this.use_native_img)e.img.opacity=i?100:0;else{if(use_gallery_img_cache||this.img_for_preload)e.style.display=i?"block":"none";else e.style.visibility=i?"inherit":"hidden"}}function imgCache_Load(i){var e;var t=false;if(!this.use_native_img&&!use_gallery_img_cache&&(!this.img_for_preload||!this.img_cache[i])){e=self[this.img_id];if(e){if(this.path_last==i)t=true;else{e.src=i;this.path_last=i}e.style.visibility="inherit"}else self[this.img_id]=this.createIMG(i);return t}e=this.img_cache[i];if(e){if(e.docked==System.Gadget.docked)t=e.initialized;else{e.docked=System.Gadget.docked;t=false}}else{e=this.img_cache[i]=this.createIMG(i);t=false}if(self[this.img_id])this.show(false);if(this.img_for_preload){this.img_for_preload=self[this.img_id];this.img_cache=[]}self[this.img_id]=e;this.show(true);return t}function imgCache_SS_Preload(){var i=this.SS_path_list[this.SS_path_list_lvl][++this.SS_path_list_index];if(++this.SS_path_list_index>=this.SS_path_list[this.SS_path_list_lvl].length){this.SS_path_list_index=-1;if(this.SS_path_list_lvl==0){var e=SEQ_gallery_all[SEQ_gallery_index];if(e.count+1>=e.loop)this.SS_path_list_lvl=1}}var t=this.img_cache[i];if(t){t.initialized=false;return}if(!use_gallery_img_cache&&this.img_for_preload){this.img_for_preload.src=i;t=this.img_cache[i]=this.img_for_preload}else{t=this.img_cache[i]=this.createIMG(i);if(!use_gallery_img_cache)this.img_for_preload=t}t.style.visibility="inherit";t.style.display="none";t.initialized=false}
if(!Date.now){Date.now=function now(){return(new Date).getTime()}}var seq_items=[];function Seq_object(){this.item=Seq_item;this.JS_timer_used=[];this.JS_timer_active=[];this.setInterval=Seq_setInterval;this.clearInterval=Seq_clearInterval;this.clearTimeout=Seq_clearInterval}function Seq_item(t){if(!seq_items[t])seq_items[t]=new Seq_core(t);return seq_items[t]}function Seq_core(t){this.name=t;this.count=0;this.At=Seq_at;this.Play=this.play=Seq_play;this.Pause=this.pause=Seq_pause;this.Stop=Seq_stop;this.exec=Seq_exec}function Seq_at(init_delay,func,max_count,interval){this.initialized=true;this.init_delay=parseInt(init_delay*1e3)+1;if(typeof func=="string")eval("this.func = function () {"+(func+(/^\s*\w+$/.test(func)?"()":""))+"}");else this.func=func;this.max_count=max_count;this.interval=this.interval_current=parseInt(interval*1e3);this.update_time_last=0}function Seq_play(){if(!this.initialized)return;this.paused=false;if(this.count){if(this.timerID)return;seq_items[this.name].exec()}else{if(this.timerID)clearTimeout(this.timerID);var t=this.name;this.timerID=setTimeout(function(){seq_items[t].exec();t=null},this.init_delay)}}var Seq_interval_current_min=10;function Seq_exec(){if(this.paused)return;if(this.count++==this.max_count){this.Stop();return}var t=Date.now();var e=this.update_time_last;var i=this.interval_current;this.interval_current=null;if(this.interval>Seq_interval_current_min&&e>0){var n=t-e-i;if(n>0){i=this.interval-n;if(i<Seq_interval_current_min)i=Seq_interval_current_min;this.interval_current=i}}this.update_time_last=t;if(this.interval_current==null)this.interval_current=this.interval;var s=this.name;this.timerID=setTimeout(function(){seq_items[s].exec();s=null},this.interval_current);this.func()}function Seq_stop(){this.Pause();this.count=0;if(Seq.onstop)Seq.onstop(this.name)}function Seq_pause(){this.paused=true;if(!this.timerID)return;clearTimeout(this.timerID);this.timerID=null}function Seq_setInterval(t,e){var i=-1;for(var n=0;n<this.JS_timer_used.length;n++){if(!this.JS_timer_used[n]){i=n;break}}if(i==-1)i=this.JS_timer_used.length;var s="T"+Date.now();while(this.JS_timer_active[s]){s+="-0"}this.JS_timer_active[s]=i+1;this.JS_timer_used[i]=true;e/=1e3;var r=Seq.item("JS-timer"+i);r.At(e,t,-1,e);r.Play();DEBUG_show("SI:"+i,2);return s}function Seq_clearInterval(t){var e=this.JS_timer_active[t];if(!e){return}e--;this.JS_timer_active[t]=null;this.JS_timer_used[e]=null;Seq.item("JS-timer"+e).Stop();DEBUG_show("CI:"+e,2)}var Seq,SeqOBJ;Seq=SeqOBJ=new Seq_object;
function Shell_ReturnItemsFromFolder(e,t,l){if(!t)t={};if(!t.RE_items)t.RE_items=/\.(bmp|gif|jpg|jpeg|png)$/i;if(!t.gallery)t.gallery=[];if(!l)t._shell_item_count=0;var i;try{i=System.Shell.itemFromPath(e)}catch(s){}if(!i)return l?null:[];var r=i.SHFolder.Items;for(var n=0,a=r.count;n<a;n++){if(++t._shell_item_count>9999){if(l)return null;else break}var m=r.item(n);if(m.isLink){var o;try{o=System.Shell.itemFromPath(m.link.path)}catch(s){}if(!o)continue;m=o}if(m.isFolder){if(!Shell_ReturnItemsFromFolder(m.path,t,true)){if(l)return null}}else if(m.isFileSystem){var e=m.path;if(!t.RE_items.test(e))continue;var f={index:t.gallery.length,path:e,path_file:toFileProtocol(e)};t.gallery.push(f)}}return t.gallery}
var WMI_obj;var WMI_objs_count=0;var WMI_refreshers=[];var WMI_refreshers_count=0;var PC_count_absolute=0;var xul_mode,webkit_mode;var WMI_AL_mode;if(xul_mode||webkit_mode)WMI_AL_mode=true;var WMI_AL_timerID;var WMI_AL_js_path,WMI_AL_temp_path,WMI_AL_temp_filename;var WMI_AL_WSH_result_obj;var WMI_AL_refresher_id=[];var Shell_OBJ,FSO_OBJ,oShell;function WMI_CreateObject(e){if(WMI_AL_mode){if(!Shell_OBJ)Shell_OBJ=new ActiveXObject("Shell.Application");if(!FSO_OBJ)FSO_OBJ=new ActiveXObject("Scripting.FileSystemObject");if(!oShell)oShell=new ActiveXObject("WScript.Shell");if(!e||xul_mode||webkit_mode)return}if(WMI_obj)return;WMI_obj=self.GetObject?GetObject("winmgmts:"):new ActiveXObject("WbemScripting.SWbemLocator").ConnectServer()}function WMI_Refresher(e,t){this.loaded=false;this.refresher=null;this.objs=null;this.collection=[];this.WMI_class=e;this.refresher_id=t?t:null;this.init=WMI_Refresher_init;this.update=WMI_Refresher_update;this.refresh=WMI_Refresher_refresh}function WMI_Refresher_init(){if(this.loaded)return;this.loaded=true;if(this.refresher_id)WMI_objs_count++;try{WMI_CreateObject(!this.refresher_id);if(WMI_AL_mode){if(!this.refresher_id)return;if(WMI_perfmon.init(this)){return}WMI_AL_refresher_id[this.WMI_class]=this.refresher_id;WMI_AL_run_timer();return}if(!this.refresher_id)return;var e=WMI_refreshers[this.refresher_id];if(!e){e={obj:new ActiveXObject("WbemScripting.SWbemRefresher"),WMI_class_objs:{}};WMI_refreshers[this.refresher_id]=e;WMI_refreshers_count++}this.refresher=e;var t=e.WMI_class_objs[this.WMI_class];if(t)this.objs=t;else this.objs=e.WMI_class_objs[this.WMI_class]=e.obj.AddEnum(WMI_obj,this.WMI_class)}catch(r){alert(r.toString())}}function WMI_Refresher_refresh(){try{if(!this.refresher_id)return;if(WMI_AL_mode)return;var e=this.refresher;if(e.refreshed_count_last==PC_count_absolute)return true;e.refreshed_count_last=PC_count_absolute;e.obj.Refresh()}catch(t){}}function WMI_Refresher_update(e){var t=[];try{if(this.refresh()&&this.refreshed_count_last==PC_count_absolute){t=this.collection}else{if(WMI_AL_mode&&this.refresher_id){var r=WMI_AL_temp_path+"\\"+WMI_AL_temp_filename+".txt";var i;if(WMI_AL_WSH_result_obj&&this.refreshed_count_last==PC_count_absolute)i=WMI_AL_WSH_result_obj;else{try{if(FSO_OBJ.FileExists(r)){var _=FSO_OBJ.OpenTextFile(r,1);var n=_.ReadLine();WMI_AL_WSH_result_obj=i=JSON.parse(n);_.Close()}}catch(L){WMI_AL_WSH_result_obj=i=null}}var s=this.WMI_class;if(!i||!i[s]){var o=WMI_AL_ref[s];for(var a=0;a<o.collection_length_default;a++)t.push(o.properties)}else t=i[s];try{if(!this.tmp_file_update_count_last)this.tmp_file_update_count_last=this.refreshed_count_last;if(this.tmp_file_update_count_last<this.refreshed_count_last-100){this.tmp_file_update_count_last=this.refreshed_count_last;if(xul_mode){var _=FSO_OBJ.OpenTextFile(WMI_AL_temp_path+"\\"+WMI_AL_temp_filename+".tmp",2,false);_.Write("");_.Close()}else{var c=new Date;var l=c.getMonth()+1+"/"+c.getDate()+"/"+c.getFullYear()+" "+((c.getHours()+11)%12+1)+":"+("00"+c.getMinutes()).slice(-2)+":"+("00"+c.getSeconds()).slice(-2)+" "+(c.getHours()<12&&"AM"||"PM");var f=Shell_OBJ.NameSpace(WMI_AL_temp_path).ParseName(WMI_AL_temp_filename+".tmp");f.ModifyDate=c}}}catch(L){}}else{var u=true;var h;if(this.refresher_id)h=this.objs.ObjectSet;else{if(xul_mode||webkit_mode){u=false;var s=this.WMI_class;var m=s+",(),0";var p=System.Gadget.path+"\\js\\wmi_al.wsf";var I=oShell.ExpandEnvironmentStrings("%TEMP%");var M="TEMP_WMI_one-time"+("_"+Date.now())+("-"+Math.random()).replace(/0\./,"");var n,i;if(xul_mode){XPCOM_object["Shell.Application"]._run(p,encodeURIComponent(M)+" "+encodeURIComponent(m),true,SystemEXT.enforce_WSH);try{var W=FileIO.open(I+"\\"+M+".txt");n=FileIO.readText(W);FileIO.unlink(W)}catch(L){DEBUG_show(L.toString())}}else{WebKit_object["Shell.Application"]._run(p,encodeURIComponent(M)+" "+encodeURIComponent(m),null,true);I+="\\"+M+".txt";try{var d=require("fs");if(d.existsSync(I)){n=d.readFileSync(I);d.unlinkSync(I)}}catch(L){DEBUG_show(L.toString())}}if(n)i=JSON.parse(n);if(!i||!i[s]){var o=WMI_AL_ref[s];for(var a=0;a<o.collection_length_default;a++)t.push(o.properties)}else t=i[s]}else if(!e){h=WMI_obj.InstancesOf(this.WMI_class)}else{h=WMI_obj.ExecQuery("SELECT * FROM "+this.WMI_class+" WHERE "+e)}}if(u){var g=new Enumerator(h);for(;!g.atEnd();g.moveNext())t.push(g.item())}}this.refreshed_count_last=PC_count_absolute}}catch(v){}this.collection=t;return t}function WMI_AL_stop(){try{if(WMI_AL_script_running){FSO_OBJ.DeleteFile(WMI_AL_temp_path+"\\"+WMI_AL_temp_filename+".tmp")}}catch(e){alert(e.toString())}}var WMI_AL_script_running;function WMI_AL_run_timer(){if(WMI_AL_script_running)return;if(WMI_AL_timerID){clearTimeout(WMI_AL_timerID);WMI_AL_timerID=null}WMI_AL_timerID=setTimeout(WMI_AL_run_command,10)}function WMI_AL_run_command(){var paras=[];var c;for(c in WMI_AL_refresher_id){if(c&&!/shuffle/.test(c)){paras.push(c+","+WMI_AL_refresher_id[c]+","+eval(WMI_AL_ref[c].timer_interval))}}if(!paras.length)return;if(!WMI_AL_js_path)WMI_AL_js_path=System.Gadget.path+"\\js\\wmi_al.wsf";if(!WMI_AL_temp_path)WMI_AL_temp_path=oShell.ExpandEnvironmentStrings("%TEMP%");if(!WMI_AL_temp_filename)WMI_AL_temp_filename=(self.Settings&&Settings.f_path?Settings.f_path.replace(/^.+\\/,"").replace(/\s/g,"_"):"TEMP")+("_"+Date.now())+("-"+Math.random()).replace(/0\./,"");FSO_OBJ.OpenTextFile(WMI_AL_temp_path+"\\"+WMI_AL_temp_filename+".txt",2,true).Close();FSO_OBJ.OpenTextFile(WMI_AL_temp_path+"\\"+WMI_AL_temp_filename+".tmp",2,true).Close();WMI_AL_script_running=true;Shell_OBJ.ShellExecute(WMI_AL_js_path,encodeURIComponent(WMI_AL_temp_filename)+" "+encodeURIComponent(paras.join("|")));DEBUG_show("Use WMI",2)}var WMI_perfmon;if(is_SA_child_animation){WMI_perfmon=parent.WMI_perfmon}else{WMI_perfmon={perfmon:null,counter:{},loaded:false,init:function(e){if(!webkit_electron_mode)return false;if(!windows_mode)return true;if(!this.loaded){this.loaded=true;this.perfmon=SA_require("perfmon")}switch(e.WMI_class){case"Win32_PerfFormattedData_PerfDisk_LogicalDisk":e.update=WMI_perfmon.update_func("LogicalDisk");if(!WMI_perfmon.LogicalDisk_counter_list){WMI_perfmon.perfmon.list("LogicalDisk",function(e,t){WMI_perfmon.LogicalDisk_init(e,t)})}break;case"Win32_PerfFormattedData_Tcpip_NetworkInterface":e.update=WMI_perfmon.update_func("Network Interface");if(!WMI_perfmon.NetworkInterface_counter_list){WMI_perfmon.perfmon.list("Network Interface",function(e,t){WMI_perfmon.NetworkInterface_init(e,t)})}break;case"Win32_PerfFormattedData_GPUPerformanceCounters_GPUEngine":e.update=WMI_perfmon.update_func("GPU Engine");if(!WMI_perfmon.GPUEngine_counter_list){WMI_perfmon.perfmon.list("GPU Engine",function(e,t){WMI_perfmon.GPUEngine_init(e,t)})}break;case"Win32_PerfFormattedData_PerfOS_Memory":e.update=WMI_perfmon.update_func("Memory");WMI_perfmon.run(["Memory\\Pages Input/sec","Memory\\Pages Output/sec"]);break;default:return false}return true},update_func:function(e){return function(){this.collection=WMI_perfmon.counter_result[e];return this.collection}},run_timerID:null,run:function(e,t){if(this.run_timerID){clearTimeout(this.run_timerID)}if(!t){e.forEach(function(e){WMI_perfmon.counter[e]=true})}this.run_timerID=setTimeout(function(){WMI_perfmon.run_timerID=null;WMI_perfmon.counter_start()},1e3)},counter_result:{LogicalDisk:[],"Network Interface":[],"GPU Engine":[],Memory:[]},counter_started:false,counter_start:function(){if(!this.counter_started){this.counter_started=true;DEBUG_show("Use Perfmon",2)}WMI_perfmon.perfmon(Object.keys(WMI_perfmon.counter).concat(WMI_perfmon.GPUEngine_counter_list||[]),function(e,t){WMI_perfmon.counter_process(e,t)})},counter_process:function(e,t){if(e){return}this.counter_result.LogicalDisk=[];this.counter_result["Network Interface"]=[];this.counter_result["GPU Engine"]=[];this.counter_result.Memory=[];var r={};for(var i in t.counters){var _=t.counters[i];if(/LogicalDisk\(([^\)]+)\)/.test(i)){this.counter_result.LogicalDisk.push({Name:RegExp.$1,PercentDiskTime:_})}else if(/Network Interface\(([^\)]+)\)/.test(i)){var n=RegExp.$1;var s=r[n];if(!s)s=r[n]={};if(/Bytes Received\/sec/.test(i)){s.BytesReceivedPerSec=_}else if(/Bytes Sent\/sec/.test(i)){s.BytesSentPerSec=_}}else if(/GPU Engine/.test(i)){this.counter_result["GPU Engine"].push({UtilizationPercentage:_})}else if(/Memory/.test(i)){var o=this.counter_result.Memory;if(!o[0])o=this.counter_result.Memory=[{}];if(i=="Memory\\Pages Input/sec"){o[0].PagesInputPerSec=_}else if(i=="Memory\\Pages Output/sec"){o[0].PagesOutputPerSec=_}}}for(var n in r){this.counter_result["Network Interface"].push(r[n])}},LogicalDisk_drive_list:null,LogicalDisk_counter_list:null,LogicalDisk_init:function(e,t){if(e){DEBUG_show(e.message);return}this.LogicalDisk_drive_list=[];this.LogicalDisk_counter_list=[];t.counters.forEach(function(e){if(!/LogicalDisk\(([^\)]+)\)\\\% Disk Time/.test(e))return;var t=RegExp.$1;if(t=="_Total"){WMI_perfmon.LogicalDisk_counter_list.push(e)}else if(/^\w\:$/.test(t)){WMI_perfmon.LogicalDisk_drive_list.push(t);WMI_perfmon.LogicalDisk_counter_list.push(e)}});this.run(this.LogicalDisk_counter_list)},NetworkInterface_counter_list:null,NetworkInterface_init:function(e,t){if(e){DEBUG_show(e.message);return}this.NetworkInterface_counter_list=[];t.counters.forEach(function(e){if(!/Network Interface\(([^\)]+)\)\\Bytes (Received|Sent)\/sec/.test(e))return;WMI_perfmon.NetworkInterface_counter_list.push(e)});this.run(this.NetworkInterface_counter_list)},GPUEngine_counter_list:null,GPUEngine_init:function(e,t){if(e){DEBUG_show(e.message);return}var r=[];t.counters.filter(e=>e.indexOf("3D)\\Utilization Percentage")!=-1).forEach(function(e){r.push(e)});if(!this._GPUEngine_counter_list_timerID){this._GPUEngine_counter_list_timerID=setInterval(function(){WMI_perfmon.perfmon.list("GPU Engine",function(e,t){WMI_perfmon.GPUEngine_init(e,t)})},5*1e3)}else{if(this.GPUEngine_counter_list.length==r.length&&this.GPUEngine_counter_list.every(e=>r.indexOf(e)!=-1))return}this.GPUEngine_counter_list=r;this.run(this.GPUEngine_counter_list,true)}}}if(WMI_AL_mode)document.write('<script type="text/javascript" language="javascript" src="js/wmi_al_core.js"></scr'+"ipt>\n");
